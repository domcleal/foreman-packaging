From c5d35326bf2d7107b36b1160929388d8f60f2ad7 Mon Sep 17 00:00:00 2001
From: Dominic Cleal <dominic@cleal.org>
Date: Thu, 7 Apr 2016 15:43:05 +0100
Subject: [PATCH] refs #14450 - remove Puppet ASTs from validations list

---
 lib/kafo_parsers/puppet_module_parser.rb |  8 +++++++-
 lib/kafo_parsers/validation.rb           | 10 ++++++++++
 2 files changed, 17 insertions(+), 1 deletion(-)
 create mode 100644 lib/kafo_parsers/validation.rb

diff --git a/lib/kafo_parsers/puppet_module_parser.rb b/lib/kafo_parsers/puppet_module_parser.rb
index 18548e2..bc119a7 100644
--- a/lib/kafo_parsers/puppet_module_parser.rb
+++ b/lib/kafo_parsers/puppet_module_parser.rb
@@ -1,5 +1,6 @@
 # encoding: UTF-8
 require 'kafo_parsers/doc_parser'
+require 'kafo_parsers/validation'

 module KafoParsers
   # Based on ideas from puppet-parse by Johan van den Dorpe
@@ -75,7 +76,12 @@ module KafoParsers

     def validations(param = nil)
       return [] if @object.code.nil?
-      @object.code.select { |stmt| stmt.is_a?(Puppet::Parser::AST::Function) && stmt.name =~ /^validate_/ }
+      @object.code.select { |stmt| stmt.is_a?(Puppet::Parser::AST::Function) && stmt.name =~ /^validate_/ }.map do |v|
+        args = v.arguments.map do |arg|
+          arg.is_a?(Puppet::Parser::AST::Variable) ? arg.to_s : arg.value
+        end
+        Validation.new(v.name, args)
+      end
     end

     # returns data in following form
diff --git a/lib/kafo_parsers/validation.rb b/lib/kafo_parsers/validation.rb
new file mode 100644
index 0000000..becd41d
--- /dev/null
+++ b/lib/kafo_parsers/validation.rb
@@ -0,0 +1,10 @@
+module KafoParsers
+ class Validation
+   attr_reader :name, :arguments
+
+   def initialize(name, arguments)
+     @name = name
+     @arguments = arguments
+   end
+ end
+end
--
2.4.3
