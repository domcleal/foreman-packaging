From 0849fea3739fb6196543a87472778b09c2ebb267 Mon Sep 17 00:00:00 2001
From: Dominic Cleal <dominic@cleal.org>
Date: Thu, 7 Apr 2016 15:43:05 +0100
Subject: [PATCH 2/2] refs #14450 - remove Puppet ASTs from validations list

---
 lib/kafo_parsers/parsers.rb              |  3 ++-
 lib/kafo_parsers/puppet_module_parser.rb |  5 ++++-
 lib/kafo_parsers/validation.rb           | 10 ++++++++++
 3 files changed, 16 insertions(+), 2 deletions(-)
 create mode 100644 lib/kafo_parsers/validation.rb

diff --git a/lib/kafo_parsers/parsers.rb b/lib/kafo_parsers/parsers.rb
index 27828f6..c1176ef 100644
--- a/lib/kafo_parsers/parsers.rb
+++ b/lib/kafo_parsers/parsers.rb
@@ -1,4 +1,5 @@
-require 'kafo_parsers/puppet_module_parser.rb'
+require 'kafo_parsers/puppet_module_parser'
+require 'kafo_parsers/validation'

 module KafoParsers
   module Parsers
diff --git a/lib/kafo_parsers/puppet_module_parser.rb b/lib/kafo_parsers/puppet_module_parser.rb
index 18548e2..e493c5e 100644
--- a/lib/kafo_parsers/puppet_module_parser.rb
+++ b/lib/kafo_parsers/puppet_module_parser.rb
@@ -1,5 +1,6 @@
 # encoding: UTF-8
 require 'kafo_parsers/doc_parser'
+require 'kafo_parsers/validation'

 module KafoParsers
   # Based on ideas from puppet-parse by Johan van den Dorpe
@@ -75,7 +76,9 @@ module KafoParsers

     def validations(param = nil)
       return [] if @object.code.nil?
-      @object.code.select { |stmt| stmt.is_a?(Puppet::Parser::AST::Function) && stmt.name =~ /^validate_/ }
+      @object.code.select { |stmt| stmt.is_a?(Puppet::Parser::AST::Function) && stmt.name =~ /^validate_/ }.map do |v|
+        Validation.new(v.name, v.arguments.map(&:to_s))
+      end
     end

     # returns data in following form
diff --git a/lib/kafo_parsers/validation.rb b/lib/kafo_parsers/validation.rb
new file mode 100644
index 0000000..becd41d
--- /dev/null
+++ b/lib/kafo_parsers/validation.rb
@@ -0,0 +1,10 @@
+module KafoParsers
+ class Validation
+   attr_reader :name, :arguments
+
+   def initialize(name, arguments)
+     @name = name
+     @arguments = arguments
+   end
+ end
+end
--
2.4.3
